---
/**
 * SEOHead - Componente SEO con soporte multiidioma
 *
 * Incluye:
 * - Meta tags básicos
 * - Open Graph
 * - Twitter Cards
 * - hreflang tags para SEO multiidioma
 * - Schema.org JSON-LD
 */

import { type Lang } from "@/config/pages";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  lang?: Lang;
  type?: "website" | "article";
  noindex?: boolean;
  alternateUrls?: { lang: Lang; url: string }[];
}

const {
  title,
  description,
  image = "/images/og-default.jpg",
  lang = "es",
  type = "website",
  noindex = false,
  alternateUrls = [],
} = Astro.props;

// Configuración de idiomas para hreflang (definido localmente)
const langConfig: Record<Lang, { code: string; name: string }> = {
  es: { code: "es", name: "Español" },
  en: { code: "en", name: "English" },
  fr: { code: "fr", name: "Français" },
  ca: { code: "ca", name: "Català" },
  "pt-br": { code: "pt-BR", name: "Português" },
};

// Traducciones para meta defaults
const metaDefaults: Record<Lang, { title: string; description: string; keywords: string }> = {
  es: {
    title: "RayGold - Software ERP para Joyería",
    description: "Software de gestión integral para el sector joyero. ERP especializado con módulos de fabricación, comercial, finanzas y más. +35 años de experiencia.",
    keywords: "ERP joyería, software joyería, gestión joyería, RayGold, fabricación joyas, control mermas oro",
  },
  en: {
    title: "RayGold - Jewelry ERP Software",
    description: "Comprehensive management software for the jewelry sector. Specialized ERP with manufacturing, commercial, finance modules and more. +35 years of experience.",
    keywords: "jewelry ERP, jewelry software, jewelry management, RayGold, jewelry manufacturing, gold waste control",
  },
  fr: {
    title: "RayGold - Logiciel ERP pour Bijouterie",
    description: "Logiciel de gestion intégrale pour le secteur de la bijouterie. ERP spécialisé avec modules de fabrication, commercial, finances et plus. +35 ans d'expérience.",
    keywords: "ERP bijouterie, logiciel bijouterie, gestion bijouterie, RayGold, fabrication bijoux, contrôle pertes or",
  },
  ca: {
    title: "RayGold - Programari ERP per a Joieria",
    description: "Programari de gestió integral per al sector joier. ERP especialitzat amb mòduls de fabricació, comercial, finances i més. +35 anys d'experiència.",
    keywords: "ERP joieria, programari joieria, gestió joieria, RayGold, fabricació joies, control pèrdues or",
  },
  "pt-br": {
    title: "RayGold - Software ERP para Joalheria",
    description: "Software de gestão integral para o setor joalheiro. ERP especializado com módulos de fabricação, comercial, finanças e mais. +35 anos de experiência.",
    keywords: "ERP joalheria, software joalheria, gestão joalheria, RayGold, fabricação joias, controle perdas ouro",
  },
};

const siteUrl = Astro.site?.toString().replace(/\/$/, "") || "https://www.raygold.es";
const currentUrl = new URL(Astro.url.pathname, siteUrl).toString();

// Usar traducciones como fallback
const defaults = metaDefaults[lang] || metaDefaults.es;
const pageTitle = title || defaults.title;
const pageDescription = description || defaults.description;
const pageImage = image.startsWith("http") ? image : `${siteUrl}${image}`;

// Código de idioma completo para Open Graph
const ogLocale = langConfig[lang]?.code.replace("-", "_") || "es";

// Schema.org JSON-LD para Software
const schemaOrg = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  name: "RayGold ERP",
  applicationCategory: "BusinessApplication",
  operatingSystem: "Web, Windows",
  description: pageDescription,
  url: siteUrl,
  offers: {
    "@type": "Offer",
    price: "29",
    priceCurrency: "EUR",
    priceValidUntil: new Date(new Date().getFullYear() + 1, 11, 31)
      .toISOString()
      .split("T")[0],
  },
  aggregateRating: {
    "@type": "AggregateRating",
    ratingValue: "4.8",
    ratingCount: "150",
    bestRating: "5",
    worstRating: "1",
  },
  provider: {
    "@type": "Organization",
    name: "Raytecno BCN SL",
    url: siteUrl,
    logo: `${siteUrl}/images/logo.svg`,
    address: {
      "@type": "PostalAddress",
      addressLocality: "Montgat",
      addressRegion: "Barcelona",
      addressCountry: "ES",
    },
    contactPoint: {
      "@type": "ContactPoint",
      telephone: "+34-648-088-550",
      contactType: "sales",
      availableLanguage: ["Spanish", "English", "French", "Catalan", "Portuguese"],
    },
  },
};

// Schema.org para la organización
const schemaOrganization = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: "Raytecno BCN SL",
  url: siteUrl,
  logo: `${siteUrl}/images/logo.svg`,
  description: "Software ERP especializado para el sector joyero. Más de 35 años de experiencia.",
  foundingDate: "1990",
  address: {
    "@type": "PostalAddress",
    addressLocality: "Montgat",
    addressRegion: "Barcelona",
    postalCode: "08390",
    addressCountry: "ES",
  },
  sameAs: ["https://www.linkedin.com/company/raytecno"],
};
---

<!-- Meta básicos -->
<title>{pageTitle}</title>
<meta name="description" content={pageDescription} />
<meta name="keywords" content={defaults.keywords} />
<link rel="canonical" href={currentUrl} />

<!-- Robots -->
{noindex ? (
  <meta name="robots" content="noindex, nofollow" />
) : (
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
)}

<!-- hreflang tags para SEO multiidioma -->
{alternateUrls.map((alt) => (
  <link rel="alternate" hreflang={langConfig[alt.lang]?.code || alt.lang} href={alt.url} />
))}

<!-- x-default para el idioma por defecto (español) -->
{alternateUrls.length > 0 && (
  <link rel="alternate" hreflang="x-default" href={alternateUrls.find(a => a.lang === 'es')?.url || `${siteUrl}/es/`} />
)}

<!-- Open Graph -->
<meta property="og:type" content={type} />
<meta property="og:url" content={currentUrl} />
<meta property="og:title" content={pageTitle} />
<meta property="og:description" content={pageDescription} />
<meta property="og:image" content={pageImage} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content={pageTitle} />
<meta property="og:locale" content={ogLocale} />
<meta property="og:site_name" content="RayGold ERP" />

<!-- Locales alternativos para Open Graph -->
{Object.entries(langConfig)
  .filter(([code]) => code !== lang)
  .map(([code, info]) => (
    <meta property="og:locale:alternate" content={info.code.replace("-", "_")} />
  ))
}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={currentUrl} />
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={pageDescription} />
<meta name="twitter:image" content={pageImage} />

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<meta name="theme-color" content="#667eea" />

<!-- Preconnect para rendimiento -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="preconnect" href="https://raygoldstorage.blob.core.windows.net" />

<!-- DNS Prefetch -->
<link rel="dns-prefetch" href="https://www.google-analytics.com" />

<!-- Schema.org JSON-LD -->
<script type="application/ld+json" set:html={JSON.stringify(schemaOrg)} />
<script type="application/ld+json" set:html={JSON.stringify(schemaOrganization)} />
