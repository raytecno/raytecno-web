---
/**
 * SEOHead - Componente SEO con soporte multiidioma
 *
 * Incluye:
 * - Meta tags básicos
 * - Open Graph
 * - Twitter Cards
 * - hreflang tags para SEO multiidioma
 * - Schema.org JSON-LD
 */

import { languages, defaultLang, type Language } from "../i18n/config";
import { getAlternateUrls, useTranslations } from "../i18n/utils";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  lang?: Language;
  type?: "website" | "article";
  noindex?: boolean;
}

const {
  title,
  description,
  image = "/images/og-default.jpg",
  lang = defaultLang,
  type = "website",
  noindex = false,
} = Astro.props;

const t = useTranslations(lang);
const siteUrl =
  Astro.site?.toString().replace(/\/$/, "") || "https://www.raytecno.es";
const currentUrl = new URL(Astro.url.pathname, siteUrl).toString();

// Usar traducciones como fallback
const pageTitle = title || t("meta.title");
const pageDescription = description || t("meta.description");
const pageImage = image.startsWith("http") ? image : `${siteUrl}${image}`;

// Generar URLs alternativas para hreflang
const alternateUrls = getAlternateUrls(Astro.url.pathname, siteUrl);

// Código de idioma completo para Open Graph
const ogLocale = languages[lang].code.replace("-", "_");

// Schema.org JSON-LD para Software
const schemaOrg = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  name: "RayGold ERP",
  applicationCategory: "BusinessApplication",
  operatingSystem: "Web, Windows",
  description: pageDescription,
  url: siteUrl,
  offers: {
    "@type": "Offer",
    price: "29",
    priceCurrency: "EUR",
    priceValidUntil: new Date(new Date().getFullYear() + 1, 11, 31)
      .toISOString()
      .split("T")[0],
  },
  aggregateRating: {
    "@type": "AggregateRating",
    ratingValue: "4.8",
    ratingCount: "150",
    bestRating: "5",
    worstRating: "1",
  },
  provider: {
    "@type": "Organization",
    name: "Raytecno BCN SL",
    url: siteUrl,
    logo: `${siteUrl}/images/logo.svg`,
    address: {
      "@type": "PostalAddress",
      addressLocality: "Montgat",
      addressRegion: "Barcelona",
      addressCountry: "ES",
    },
    contactPoint: {
      "@type": "ContactPoint",
      telephone: "+34-933-741-047",
      contactType: "sales",
      availableLanguage: [
        "Spanish",
        "English",
        "French",
        "Catalan",
        "Portuguese",
      ],
    },
  },
};

// Schema.org para la organización
const schemaOrganization = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: "Raytecno BCN SL",
  url: siteUrl,
  logo: `${siteUrl}/images/logo.svg`,
  description:
    "Software ERP especializado para el sector joyero. Más de 30 años de experiencia.",
  foundingDate: "1994",
  address: {
    "@type": "PostalAddress",
    addressLocality: "Montgat",
    addressRegion: "Barcelona",
    postalCode: "08390",
    addressCountry: "ES",
  },
  sameAs: ["https://www.linkedin.com/company/raytecno"],
};
---

<!-- Meta básicos -->
<title>{pageTitle}</title>
<meta name="description" content={pageDescription} />
<meta name="keywords" content={t("meta.keywords")} />
<link rel="canonical" href={currentUrl} />

<!-- Robots -->
{
  noindex ? (
    <meta name="robots" content="noindex, nofollow" />
  ) : (
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />
  )
}

<!-- hreflang tags para SEO multiidioma -->
{
  alternateUrls.map((alt) => (
    <link rel="alternate" hreflang={alt.hreflang} href={alt.url} />
  ))
}
<!-- x-default para el idioma por defecto -->
<link
  rel="alternate"
  hreflang="x-default"
  href={`${siteUrl}${Astro.url.pathname.replace(/^\/(en|fr|ca|pt-br)/, "") || "/"}`}
/>

<!-- Open Graph -->
<meta property="og:type" content={type} />
<meta property="og:url" content={currentUrl} />
<meta property="og:title" content={pageTitle} />
<meta property="og:description" content={pageDescription} />
<meta property="og:image" content={pageImage} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content={pageTitle} />
<meta property="og:locale" content={ogLocale} />
<meta property="og:site_name" content="RayGold ERP" />

<!-- Locales alternativos para Open Graph -->
{
  Object.entries(languages)
    .filter(([code]) => code !== lang)
    .map(([code, info]) => (
      <meta
        property="og:locale:alternate"
        content={info.code.replace("-", "_")}
      />
    ))
}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={currentUrl} />
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={pageDescription} />
<meta name="twitter:image" content={pageImage} />

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<meta name="theme-color" content="#667eea" />

<!-- Preconnect para rendimiento -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="preconnect" href="https://raygoldstorage.blob.core.windows.net" />

<!-- DNS Prefetch -->
<link rel="dns-prefetch" href="https://www.google-analytics.com" />

<!-- Schema.org JSON-LD -->
<script type="application/ld+json" set:html={JSON.stringify(schemaOrg)} />
<script
  type="application/ld+json"
  set:html={JSON.stringify(schemaOrganization)}
/>
