---
// src/pages/modulos/maestros.astro
import Layout from "../../layouts/Layout.astro";
import { getModuloBySlug } from "../../wordpress";

// Interfaces TypeScript
interface Imagen {
  url: string;
  titulo: string;
  descripcion: string;
}

interface Seccion {
  id: string;
  nombre: string;
  descripcion: string;
  imagenes: Imagen[];
}

// Obtener datos de WordPress
const modulo = await getModuloBySlug("maestros");

// Base URL para im√°genes de Azure Blob Storage
const blobBaseUrl = "https://raygoldstorage.blob.core.windows.net/web";

// Datos del m√≥dulo
const titulo = modulo?.title || "Maestros";
const subtitulo = modulo?.subtitulo || "Art√≠culos, proveedores, clientes y familias";
const iconoSvg = modulo?.iconoSvg || `<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/><path d="M9 12h6M9 16h6"/></svg>`;
const color = modulo?.color || "#667eea";

// Secciones del m√≥dulo
let secciones: Seccion[] = modulo?.secciones || [];

// Si no hay secciones de WordPress, usar datos por defecto
if (secciones.length === 0) {
  secciones = [
    {
      id: "articulos",
      nombre: "Art√≠culos",
      descripcion: "Gesti√≥n completa del cat√°logo de art√≠culos",
      imagenes: [
        { url: `${blobBaseUrl}/A01.png`, titulo: "Listado de Art√≠culos", descripcion: "Vista general del cat√°logo con filtros avanzados" },
        { url: `${blobBaseUrl}/A02.png`, titulo: "Ficha de Art√≠culo", descripcion: "Detalle completo con especificaciones" },
        { url: `${blobBaseUrl}/A03.png`, titulo: "Configuraci√≥n", descripcion: "Personalizaci√≥n de campos y atributos" }
      ]
    },
    {
      id: "precios",
      nombre: "Precios",
      descripcion: "Tarifas, descuentos y listas de precios",
      imagenes: [
        { url: `${blobBaseUrl}/P01.png`, titulo: "Tarifas", descripcion: "Gesti√≥n de tarifas por cliente" },
        { url: `${blobBaseUrl}/P02.png`, titulo: "Descuentos", descripcion: "Configuraci√≥n de descuentos" },
        { url: `${blobBaseUrl}/P03.png`, titulo: "Hist√≥rico", descripcion: "Evoluci√≥n de precios" }
      ]
    },
    {
      id: "estructuras",
      nombre: "Estructuras",
      descripcion: "Composici√≥n y estructura de productos",
      imagenes: [
        { url: `${blobBaseUrl}/E01.png`, titulo: "Componentes", descripcion: "Gesti√≥n de componentes" },
        { url: `${blobBaseUrl}/E02.png`, titulo: "Aleaciones", descripcion: "Composici√≥n de aleaciones" },
        { url: `${blobBaseUrl}/E03.png`, titulo: "Materiales", descripcion: "Cat√°logo de materiales" }
      ]
    },
    {
      id: "imagenes",
      nombre: "Im√°genes",
      descripcion: "Galer√≠a de im√°genes del producto",
      imagenes: [
        { url: `${blobBaseUrl}/I01.png`, titulo: "Galer√≠a", descripcion: "Galer√≠a de im√°genes" },
        { url: `${blobBaseUrl}/I02.png`, titulo: "Visor", descripcion: "Visor de alta resoluci√≥n" },
        { url: `${blobBaseUrl}/I03.png`, titulo: "Gesti√≥n", descripcion: "Administraci√≥n de archivos" }
      ]
    },
    {
      id: "layout",
      nombre: "Layout",
      descripcion: "Personalizaci√≥n de la interfaz",
      imagenes: [
        { url: `${blobBaseUrl}/L01.png`, titulo: "Dise√±o", descripcion: "Configuraci√≥n de vistas" },
        { url: `${blobBaseUrl}/L02.png`, titulo: "Columnas", descripcion: "Personalizaci√≥n de columnas" },
        { url: `${blobBaseUrl}/L03.png`, titulo: "Exportar", descripcion: "Opciones de exportaci√≥n" }
      ]
    }
  ];
}

// Iconos SVG para cada secci√≥n
const iconosSecciones: Record<string, string> = {
  articulos: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/><path d="M9 12h6M9 16h6"/></svg>`,
  precios: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>`,
  estructuras: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>`,
  imagenes: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>`,
  layout: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>`
};

// Tooltips para cada secci√≥n
const tooltipsSecciones: Record<string, string> = {
  articulos: "Gesti√≥n completa del cat√°logo de art√≠culos",
  precios: "Tarifas, descuentos y listas de precios",
  estructuras: "Composici√≥n y estructura de productos",
  imagenes: "Galer√≠a de im√°genes del producto",
  layout: "Personalizaci√≥n de la interfaz"
};
---

<Layout title={`${titulo} - RayGold ERP`}>
  <main class="modulo-page">
    <!-- Header del m√≥dulo -->
    <header class="modulo-header">
      <div class="header-left">
        <div class="header-icon" set:html={iconoSvg} />
        <div class="header-text">
          <h1>{titulo}</h1>
          <p>{subtitulo}</p>
        </div>
      </div>
      <a href="/" class="back-link">‚Üê Volver al inicio</a>
    </header>

    <!-- Navegaci√≥n de tabs - DISE√ëO ORIGINAL -->
    <nav class="tabs-nav">
      {secciones.map((seccion, index) => (
        <button 
          class={`tab-btn ${index === 0 ? 'active' : ''}`}
          data-section={seccion.id}
          data-tooltip={tooltipsSecciones[seccion.id] || seccion.descripcion}
        >
          <div class={`tab-icon tab-icon-${seccion.id}`} set:html={iconosSecciones[seccion.id] || iconosSecciones.articulos} />
          <span class="tab-name">{seccion.nombre}</span>
          <!-- Tooltip element -->
          <span class="tooltip">{tooltipsSecciones[seccion.id] || seccion.descripcion}</span>
        </button>
      ))}
    </nav>

    <!-- Contenido de las secciones -->
    <div class="sections-container">
      {secciones.map((seccion, index) => (
        <section 
          class={`section-content ${index === 0 ? 'active' : ''}`}
          data-section={seccion.id}
        >
          <div class="section-header">
            <h2>{seccion.nombre}</h2>
            <p>{seccion.descripcion}</p>
          </div>

          <div class="gallery-grid">
            {seccion.imagenes.map((imagen) => (
              <div class="gallery-item" data-url={imagen.url}>
                <div class="image-wrapper">
                  <img src={imagen.url} alt={imagen.titulo} loading="lazy" />
                  <div class="image-overlay">
                    <span class="zoom-icon">üîç</span>
                  </div>
                </div>
                <div class="image-info">
                  <h3>{imagen.titulo}</h3>
                  <p>{imagen.descripcion}</p>
                </div>
              </div>
            ))}
          </div>
        </section>
      ))}
    </div>

    <!-- Modal para imagen ampliada -->
    <div class="image-modal" id="imageModal">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <button class="modal-close">‚úï</button>
        <img src="" alt="" id="modalImage" />
        <div class="modal-caption" id="modalCaption"></div>
      </div>
    </div>
  </main>
</Layout>

<style>
  /* ============================================
     PAGE LAYOUT
     ============================================ */
  .modulo-page {
    background: linear-gradient(180deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
    min-height: 100vh;
    color: white;
  }

  /* ============================================
     HEADER
     ============================================ */
  .modulo-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    background: rgba(15, 23, 42, 0.8);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    z-index: 50;
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .header-icon {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
  }

  .header-icon :global(svg) {
    width: 28px;
    height: 28px;
  }

  .header-text h1 {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0;
  }

  .header-text p {
    font-size: 0.875rem;
    color: #94a3b8;
    margin: 0;
  }

  .back-link {
    color: #94a3b8;
    text-decoration: none;
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .back-link:hover {
    color: white;
    background: rgba(255, 255, 255, 0.1);
  }

  /* ============================================
     TABS - DISE√ëO ORIGINAL CON TOOLTIP
     ============================================ */
  .tabs-nav {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    padding: 1.5rem 2rem;
    flex-wrap: wrap;
    background: rgba(15, 23, 42, 0.5);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  .tab-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid transparent;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.25s ease;
    position: relative;
    min-width: 90px;
    color: white;
  }

  /* Tab Icons - Colores originales por secci√≥n */
  .tab-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.25s ease;
    color: white;
  }

  .tab-icon :global(svg) {
    width: 24px;
    height: 24px;
  }

  /* Colores por secci√≥n - Como antes */
  .tab-icon-articulos { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
  .tab-icon-precios { background: linear-gradient(135deg, #f97316, #ea580c); }
  .tab-icon-estructuras { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
  .tab-icon-imagenes { background: linear-gradient(135deg, #06b6d4, #0891b2); }
  .tab-icon-layout { background: linear-gradient(135deg, #ec4899, #db2777); }

  .tab-name {
    font-size: 0.8rem;
    font-weight: 500;
    color: #94a3b8;
    transition: color 0.25s ease;
  }

  /* Hover */
  .tab-btn:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
  }

  .tab-btn:hover .tab-name {
    color: white;
  }

  /* Activo */
  .tab-btn.active {
    background: rgba(102, 126, 234, 0.15);
    border-color: rgba(102, 126, 234, 0.5);
  }

  .tab-btn.active .tab-name {
    color: white;
    font-weight: 600;
  }

  /* Animaci√≥n al seleccionar */
  .tab-btn.selecting {
    animation: tabPulse 0.3s ease;
  }

  @keyframes tabPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  /* ============================================
     TOOLTIP - CORREGIDO
     ============================================ */
  .tooltip {
    position: absolute;
    bottom: calc(100% + 10px);
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 12px;
    background: #1e293b;
    color: white;
    font-size: 0.75rem;
    font-weight: 500;
    white-space: nowrap;
    border-radius: 6px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    z-index: 100;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    pointer-events: none;
  }

  /* Flecha del tooltip */
  .tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: #1e293b;
  }

  /* Mostrar tooltip en hover */
  .tab-btn:hover .tooltip {
    opacity: 1;
    visibility: visible;
    bottom: calc(100% + 14px);
  }

  /* ============================================
     SECTIONS
     ============================================ */
  .sections-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
  }

  .section-content {
    display: none;
    animation: fadeIn 0.3s ease;
  }

  .section-content.active {
    display: block;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .section-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .section-header h2 {
    font-size: 1.75rem;
    font-weight: 700;
    margin: 0 0 0.5rem;
    font-style: italic;
  }

  .section-header p {
    color: #94a3b8;
    font-size: 1rem;
    margin: 0;
  }

  /* ============================================
     GALLERY
     ============================================ */
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
  }

  .gallery-item {
    background: rgba(30, 41, 59, 0.6);
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .gallery-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    border-color: rgba(102, 126, 234, 0.3);
  }

  .image-wrapper {
    position: relative;
    aspect-ratio: 16/10;
    overflow: hidden;
  }

  .image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .gallery-item:hover .image-wrapper img {
    transform: scale(1.05);
  }

  .image-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .gallery-item:hover .image-overlay {
    opacity: 1;
  }

  .zoom-icon {
    font-size: 2rem;
    background: rgba(255, 255, 255, 0.2);
    padding: 0.75rem;
    border-radius: 50%;
    backdrop-filter: blur(4px);
  }

  .image-info {
    padding: 1.25rem;
  }

  .image-info h3 {
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 0.25rem;
  }

  .image-info p {
    font-size: 0.875rem;
    color: #94a3b8;
    margin: 0;
  }

  /* ============================================
     MODAL
     ============================================ */
  .image-modal {
    position: fixed;
    inset: 0;
    z-index: 1000;
    display: none;
    align-items: center;
    justify-content: center;
  }

  .image-modal.active {
    display: flex;
  }

  .modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(8px);
  }

  .modal-content {
    position: relative;
    max-width: 90vw;
    max-height: 90vh;
    animation: modalIn 0.3s ease-out;
  }

  @keyframes modalIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }

  .modal-content img {
    max-width: 100%;
    max-height: 85vh;
    border-radius: 12px;
    box-shadow: 0 24px 64px rgba(0, 0, 0, 0.5);
  }

  .modal-close {
    position: absolute;
    top: -40px;
    right: 0;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.2s ease;
  }

  .modal-close:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  .modal-caption {
    text-align: center;
    padding: 1rem;
    color: #94a3b8;
    font-size: 0.875rem;
  }

  /* ============================================
     RESPONSIVE
     ============================================ */
  @media (max-width: 768px) {
    .modulo-header {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }

    .header-left {
      flex-direction: column;
    }

    .tabs-nav {
      gap: 0.5rem;
      padding: 1rem;
    }

    .tab-btn {
      padding: 0.75rem 1rem;
      min-width: 70px;
    }

    .tab-icon {
      width: 40px;
      height: 40px;
    }

    .tab-name {
      font-size: 0.7rem;
    }

    /* Ocultar tooltip en m√≥vil */
    .tooltip {
      display: none;
    }

    .sections-container {
      padding: 1rem;
    }

    .gallery-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Tab navigation
    const tabs = document.querySelectorAll('.tab-btn');
    const sections = document.querySelectorAll('.section-content');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const sectionId = tab.dataset.section;
        
        // Update tabs
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Animaci√≥n de pulse
        tab.classList.add('selecting');
        setTimeout(() => tab.classList.remove('selecting'), 300);
        
        // Update sections
        sections.forEach(section => {
          if (section.dataset.section === sectionId) {
            section.classList.add('active');
          } else {
            section.classList.remove('active');
          }
        });
      });
    });

    // Image modal
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage') as HTMLImageElement;
    const modalCaption = document.getElementById('modalCaption');
    const galleryItems = document.querySelectorAll('.gallery-item');
    const modalClose = document.querySelector('.modal-close');
    const modalBackdrop = document.querySelector('.modal-backdrop');

    galleryItems.forEach(item => {
      item.addEventListener('click', () => {
        const url = item.dataset.url;
        const title = item.querySelector('h3')?.textContent || '';
        const desc = item.querySelector('.image-info p')?.textContent || '';
        
        if (modalImage && url) {
          modalImage.src = url;
          modalImage.alt = title;
        }
        if (modalCaption) {
          modalCaption.textContent = `${title} - ${desc}`;
        }
        modal?.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
    });

    const closeModal = () => {
      modal?.classList.remove('active');
      document.body.style.overflow = '';
    };

    modalClose?.addEventListener('click', closeModal);
    modalBackdrop?.addEventListener('click', closeModal);
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });
  });
</script>